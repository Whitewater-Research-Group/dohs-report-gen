<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOHS Report generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script
    src="https://code.jquery.com/jquery-3.6.3.min.js"
    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../css/reg.css">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!--  worked <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script> -->
    <!-- latest -->
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.es.min.js"></script>
    <!-- <script src="https://unpkg.com/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.js"></script> -->
    <!-- <script src="jspdf.plugin.autotable.js"></script> -->


    <!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script> -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- todo re enable caching after deployment of stable version -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- end disable cache -->
</head>
    <body>

        <div class="container .bg-primary">

            <!-- Add/Remove -->
            <div class="row">
                    <div class="col-md-2">
                    </div>
                    <!-- p-l-5 padding - left - size5 -->
                    <div class="col-md-8 border border-primary  ml-3 mb-3 mr-3">


                        <div id='message_print_all'>
                            <div id="bypassme">
                                <h2 class="text-center">DOHS PRINT CONTENT</h2>
                                <h4 class="text-center">TITLE</h4>
                                <h5 class="text-center">SUB TITLE</h5>
                                <br>
                            </div>
                            <div style="float: right;" >
                                <img id ="img-pix" class="rounded mx-auto d-block" width="150" height="150" src="../images/usr.jpg" />
                            </div>
                            <table class="table" border="1">
                            <!-- <tr><td class="mw-40" style="width: 180px;">-</td><td>-</td></tr> -->
                            <tr><td>Disease ID</td><td  id="td_matno">#1234567 </td></tr>
                            <tr><td>Diseas Name</td><td id="td_surname">Ebola</td></tr>
                            <tr><td>Report</td><td id="td_static">Static Heading </td></tr>
                            
                            </table>
                            <h5 class="text-center">REPORT</h5>
                            <table class="table" border="1" id="table_courses">
                                <tr><td>PHASE ONE</td><td>STATUS</td></tr>     

                                <tr><td><pre id="td_report1">This is and auto generated report from backend to html to pdf</pre></td> <td><pre id="td_report2">..</pre></td></tr>
                            </table>

                            <div id="previewButtons">
                                <button class="btn btn-primary btn-lg btn-block"  type="button" id="printForm" onClick="doPrintPDF();">Generate Report (Download PDF)</button> <br>
                            </div>

                        </div>
                        <div id='message_print'>

                        </div>



                    </div>
                    <div class="col-md-2">
                        <!-- Right side -->
                    </div>

            </div>
        </div>
        <hr>
        
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script> -->
        <!-- Worked -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js" integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/" crossorigin="anonymous"></script>

        <script>
            $(document).ready(function() {



            });

 

            async function saveFile(url){

                let formData = new FormData();
                var dFile =  $("#file_pix").get(0).files;
                formData.append('file_pix', dFile[0]);
                await fetch(url, {method: "POST", body: formData});
            }


            function doPrint(){
                printJS({ printable: 'regForm', type: 'html', header: 'Online Course Registration (c)2023' });
            }

            function doPrintPDF() {
                urlPDFCloud = 'https://www.rtps.keminsoft.site/public/index.php/api/';
                urlPDFLocal = 'http://localhost/rtps/web/back-end/public/index.php/api/';
                urlPDF = urlPDFCloud;


                var pdf = new jsPDF('p', 'pt', 'letter');
                var pageHeight = pdf.internal.pageSize.height || pdf.internal.pageSize.getHeight();
                var pageWidth = pdf.internal.pageSize.width || pdf.internal.pageSize.getWidth();
                var fontSize = 14;
                var startHeight = 150;

                // Header
                let strH = "AUTO GENERATED REPORT"; //  "LATE REGISTRATION FORM";
                pdf.setTextColor(100);
                pdf.setFontSize(18);
                pdf.text(strH, pageWidth / 2, 40, {align: 'center'});
                
                pdf.text("DOHS ", pageWidth / 2, 60, {align: 'center'});
                pdf.text("DETAILS" , pageWidth / 2, 80, {align: 'center'});

                // //low performance
                // var img = new Image()
                // //img.src = '../images/usr.jpg'
                // try{
                //     img.src  = urlPDF + 'jpg/' + $("#td_matno").html();
                //     pdf.addImage(img, 'jpg', pageWidth-160, startHeight-fontSize, 100, 100);
                // }catch(err){
                //     img.src = '../images/usr.jpg';
                //     pdf.addImage(img, 'jpg', pageWidth-160, startHeight-fontSize, 100, 100);
                // }

                //end header

                //content
                let strC = "TEMP VAL";
                pdf.setTextColor(100);
                pdf.setFontSize(14);
                        

                pdf.text("Disease ID.:", 80, startHeight-(fontSize*1), {align: 'left'});
                pdf.text($("#td_matno").html(), 300, startHeight-(fontSize*1), {align: 'left'}); //val

                pdf.text("Disease Name:", 80, startHeight+(fontSize*1), {align: 'left'});
                pdf.text($("#td_surname").html(), 300, startHeight+(fontSize*1), {align: 'left'}); //val

                pdf.text("Report:", 80, startHeight+(fontSize*3), {align: 'left'});
                pdf.text($("#td_static").html(), 300, startHeight+(fontSize*3), {align: 'left'}); //val

              
                
                pdf.setLineWidth(0.5);
                pdf.line(80, startHeight+(fontSize*14), pageWidth-80, startHeight+(fontSize*14)); //x1,y1,x2,y2

                //---courses
                pdf.text("PHASE 1", 80, startHeight+(fontSize*16), {align: 'left'});
                pdf.text("PHASE 2", 300, startHeight+(fontSize*16), {align: 'left'}); //val
                
                pdf.line(80, startHeight+(fontSize*17), pageWidth-80, startHeight+(fontSize*17)); //x1,y1,x2,y2

                pdf.text($("#td_report1").html(), 80, startHeight+(fontSize*19), {align: 'left'});
                pdf.text($("#td_report2").html(), 300, startHeight+(fontSize*19), {align: 'left'}); //val
            

            //sign
                pdf.line(80, pageHeight-100, 220, pageHeight-100); //x1,y1,x2,y2
                pdf.text("Stakeholder's\'s Sign", 80, pageHeight  - 100 + fontSize, {align: 'left'});
                
                pdf.line(400, pageHeight-100, 550, pageHeight-100); //x1,y1,x2,y2
                pdf.text("Manager\'s Sign", 420, pageHeight  - 100 + fontSize, {align: 'left'}); //val
            

            


                //end content

                // FOOTER
                

                let str = "DOHS Report Generator by WWRG (eddie.olaye@gmail.com) " + Date();
                pdf.setTextColor(100);
                pdf.setFontSize(10);
                pdf.text(str, pageWidth / 2, pageHeight  - 10, {align: 'center'});
                //end footer

                // source can be HTML-formatted string, or a reference to...
                source = $('#message_print')[0];

                // we support special element handlers. Register them with jQuery-style 
                // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
                // There is no support for any other type of selectors 
                // (class, of compound) at this time.
                specialElementHandlers = {
                    // element with id of "bypass" - jQuery style selector
                    '#bypassme': function (element, renderer) {
                        // true = "handled elsewhere, bypass text extraction"
                        return true
                    }
                };
                margins = {
                    top: 80,
                    bottom: 60,
                    left: 40,
                    width: 522
                };
                // all coords and widths are in jsPDF instance's declared units
                // 'inches' in this case
                pdf.fromHTML(
                source, // HTML string or DOM elem ref.
                margins.left+20, // x coord
                margins.top+100, { // y coord
                    'width': margins.width, // max width of content on PDF
                    'elementHandlers': specialElementHandlers
                },

                function (dispose) {
                    // dispose: object with X, Y of the last line add to the PDF 
                    //          this allow the insertion of new lines after html
                    pdf.save('dohs_report.pdf');
                }, margins);
            }





        </script>



      



    </body>
</html>
